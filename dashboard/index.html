<!DOCTYPE html>
<html lang="ar" dir="rtl" class="scroll-smooth">
<head>
<meta charset="UTF-8">
<title>Skillzoy Academy | Ù…Ù†ØµØ© Ø±Ø§Ø¦Ø¯Ø© ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#4F46E5">

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-check-compat.js"></script>

<!-- reCAPTCHA v3 -->
<script src="https://www.google.com/recaptcha/api.js?render=SITE_KEY_PLACEHOLDER"></script>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Cairo', 'sans-serif'],
          },
          colors: {
            primary: '#4F46E5',
            secondary: '#10B981',
            dark: '#0F172A',
          }
        }
      }
    }
</script>

<!-- Microsoft Clarity Analytics -->
<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "u9054g22tr");
</script>

<style>
    /* Global Styles */
    :root {
        --glass-border: 1px solid rgba(255, 255, 255, 0.1);
        --glass-bg: rgba(255, 255, 255, 0.85);
        --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
    }
    
    .dark :root {
        --glass-border: 1px solid rgba(255, 255, 255, 0.05);
        --glass-bg: rgba(15, 23, 42, 0.85);
    }

    body {
        font-family: 'Cairo', sans-serif;
        -webkit-tap-highlight-color: transparent;
        background-color: #F8FAFC;
        overflow-x: hidden;
    }

    .dark body {
        background-color: #020617;
        color: #E2E8F0;
    }

    /* Scrollbar Styling */
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(79, 70, 229, 0.3); border-radius: 4px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(79, 70, 229, 0.5); }

    /* Glassmorphism */
    .glass {
        background: var(--glass-bg);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: var(--glass-border);
    }

    .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    }

    .dark .glass-card {
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }

    /* Animations */
    @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
        100% { transform: translateY(0px); }
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    @keyframes slideIn {
        from { transform: translateY(100%); }
        to { transform: translateY(0); }
    }

    @keyframes slideOut {
        from { transform: translateY(0); }
        to { transform: translateY(100%); }
    }

    .animate-float { animation: float 3s ease-in-out infinite; }
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .animate-slide-in { animation: slideIn 0.3s ease-out forwards; }
    .animate-slide-out { animation: slideOut 0.3s ease-in forwards; }

    /* Skeleton Loading */
    .skeleton {
        background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
    }
    
    .dark .skeleton {
        background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
    }
    
    @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    /* Transitions */
    .trans-all { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .trans-transform { transition: transform 0.3s ease-out; }

    /* Video Container */
    .video-container {
        position: relative;
        padding-bottom: 56.25%;
        height: 0;
        overflow: hidden;
        border-radius: 16px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        background: #000;
    }
    
    .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    /* Utility Classes */
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .line-clamp-1 {
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
</head>

<body class="transition-colors duration-300 antialiased pb-24">

    <!-- Header -->
    <header class="fixed top-0 w-full z-50 glass trans-all shadow-sm">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer" onclick="showHome()">
                <div class="w-10 h-10 bg-gradient-to-tr from-indigo-600 to-violet-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-indigo-500/30">
                    <i class="fas fa-graduation-cap text-lg"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-violet-600 dark:from-indigo-400 dark:to-violet-400">Skillzoy</h1>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <button onclick="toggleDarkMode()" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 trans-all">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:block"></i>
                </button>
                
                <div class="relative cursor-pointer">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 dark:text-indigo-400">
                        <i class="fas fa-bell"></i>
                    </div>
                    <span class="absolute top-0 right-0 w-3 h-3 bg-red-500 border-2 border-white dark:border-gray-900 rounded-full animate-pulse"></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 mt-24 space-y-8">
        <!-- Hero Section -->
        <section id="heroSection" class="relative overflow-hidden rounded-3xl bg-gradient-to-r from-indigo-600 to-violet-700 p-6 md:p-10 text-white shadow-2xl shadow-indigo-500/20">
            <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="text-center md:text-right space-y-3 max-w-lg">
                    <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-md px-3 py-1 rounded-full text-sm font-medium border border-white/20">
                        <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                        <span>Ù…Ø¨Ø§Ø´Ø±: Ø¯ÙˆØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </div>
                    <h2 class="text-3xl md:text-4xl font-bold leading-tight">Ø·ÙˆØ± Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø£ÙØ¶Ù„</h2>
                    <p class="text-indigo-100 text-lg opacity-90">Ø´Ø§Ù‡Ø¯ Ù…Ù‚Ø¯Ù…Ø© Ø§Ù„Ø¯ÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ.</p>
                </div>
                <div class="hidden md:block absolute left-0 bottom-0 opacity-20">
                    <i class="fas fa-rocket text-9xl transform -rotate-45 translate-y-10 -translate-x-10"></i>
                </div>
            </div>
        </section>

        <!-- Search and Filter -->
        <section class="sticky top-20 z-40">
            <div class="glass-card p-2 rounded-2xl flex flex-col md:flex-row gap-2 shadow-lg">
                <div class="relative flex-1">
                    <i class="fas fa-search absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‡Ø§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©..." 
                        class="w-full bg-transparent border-none focus:ring-0 text-gray-700 dark:text-gray-200 pr-10 pl-4 py-3 placeholder-gray-400 focus:outline-none">
                </div>
                <div class="flex gap-2 overflow-x-auto scrollbar-hide py-1 md:py-0 px-1">
                    <select id="categoryFilter" class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 border-none rounded-xl px-4 py-2 text-sm focus:ring-0 cursor-pointer min-w-[120px] focus:outline-none">
                        <option value="">ÙƒÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Categories -->
        <section>
            <div class="flex justify-between items-end mb-4 px-1">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</h3>
            </div>
            <div id="categoriesContainer" class="flex gap-4 overflow-x-auto scrollbar-hide pb-4">
                <div class="skeleton min-w-[100px] h-28 rounded-2xl"></div>
                <div class="skeleton min-w-[100px] h-28 rounded-2xl"></div>
                <div class="skeleton min-w-[100px] h-28 rounded-2xl"></div>
            </div>
        </section>

        <!-- Courses Section -->
        <section id="coursesSection" class="min-h-[400px]">
            <div class="flex justify-between items-end mb-4 px-1">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
                    <i class="fas fa-play-circle text-indigo-500"></i>
                    Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© (Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¢Ù†)
                </h3>
            </div>
            
            <div id="coursesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Courses will be loaded here -->
            </div>
            
            <div id="noResults" class="hidden flex-col items-center justify-center py-20 text-center">
                <div class="w-24 h-24 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-search text-3xl text-gray-400"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-700 dark:text-gray-300">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬</h3>
            </div>
        </section>

        <!-- My Courses Section -->
        <section id="myCoursesView" class="hidden min-h-screen">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">Ø¯ÙˆØ±Ø§ØªÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h2>
            
            <div id="resumeLearningBanner" class="hidden mb-8 bg-gradient-to-r from-gray-900 to-indigo-900 rounded-2xl p-6 text-white relative overflow-hidden shadow-xl">
                <div class="relative z-10 flex flex-col md:flex-row md:items-center justify-between gap-4">
                    <div>
                        <div class="text-xs font-semibold text-gray-400 mb-1 uppercase tracking-wider">Ø£ÙƒÙ…Ù„ Ù…Ù† Ø­ÙŠØ« ØªÙˆÙ‚ÙØª</div>
                        <h3 id="resumeTitle" class="text-xl font-bold mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯ÙˆØ±Ø© Ù‡Ù†Ø§</h3>
                        <div class="flex items-center gap-2 text-sm text-gray-300">
                            <i class="fas fa-play-circle"></i>
                            <span id="resumeProgress">Ø§Ù„Ù…Ù‚Ø·Ø¹ 4 Ù…Ù† 12</span>
                        </div>
                    </div>
                    <button id="resumeBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-bold trans-all shadow-lg shadow-indigo-600/30">
                        Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
                    </button>
                </div>
            </div>

            <div id="myCoursesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- My courses will be loaded here -->
            </div>
        </section>

        <!-- Video Player Overlay -->
        <div id="playerOverlay" class="fixed inset-0 z-[60] bg-white dark:bg-gray-900 transform translate-y-full transition-transform duration-300 overflow-y-auto">
            <div class="sticky top-0 bg-white/90 dark:bg-gray-900/90 backdrop-blur-md z-10 px-4 py-4 border-b border-gray-100 dark:border-gray-800 flex items-center justify-between">
                <button onclick="closePlayer()" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-600 dark:text-gray-300 hover:scale-110 trans-all">
                    <i class="fas fa-arrow-right"></i>
                </button>
                <span class="font-bold text-gray-800 dark:text-gray-200">Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¯ÙˆØ±Ø©</span>
                <div class="w-10"></div>
            </div>

            <div class="max-w-5xl mx-auto px-4 py-6">
                <div class="video-container bg-black mb-6">
                    <iframe id="playerFrame" src="" frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen loading="lazy"></iframe>
                </div>

                <div class="flex flex-col lg:flex-row gap-8">
                    <div class="flex-1 space-y-4">
                        <h1 id="playerCourseTitle" class="text-2xl font-bold text-gray-900 dark:text-white leading-snug"></h1>
                        <p id="playerCourseDesc" class="text-gray-600 dark:text-gray-400 text-sm leading-relaxed"></p>
                        
                        <div class="flex items-center gap-4 py-4 border-y border-gray-100 dark:border-gray-800">
                            <button onclick="toggleCompleteVideo()" id="markCompleteBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-green-500/30 trans-all flex items-center justify-center gap-2">
                                <i class="fas fa-check-circle"></i>
                                <span>Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‚Ø·Ø¹</span>
                            </button>
                            <a href="https://wa.me/249908280115" target="_blank" class="flex-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 py-3 rounded-xl font-bold trans-all flex items-center justify-center gap-2">
                                <i class="fab fa-whatsapp text-green-500 text-xl"></i>
                                <span>Ø·Ù„Ø¨ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</span>
                            </a>
                        </div>
                    </div>

                    <div class="lg:w-96 bg-gray-50 dark:bg-gray-800/50 rounded-2xl p-4 h-fit">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-gray-800 dark:text-white">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯ÙˆØ±Ø©</h3>
                            <span id="progressPercentage" class="text-xs font-bold bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300 px-2 py-1 rounded-lg">0% Ù…ÙƒØªÙ…Ù„</span>
                        </div>
                        <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-4">
                            <div id="progressBarFill" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 w-0 trans-all duration-1000"></div>
                        </div>
                        <div id="playlistContainer" class="space-y-2 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                            <!-- Playlist items will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl border border-white/20 dark:border-gray-700 rounded-full px-6 py-3 shadow-2xl z-40 flex items-center gap-8 trans-all duration-500 w-[90%] max-w-sm justify-between">
        <button onclick="showHome()" class="nav-btn active flex flex-col items-center gap-1 text-indigo-600 dark:text-indigo-400 trans-all">
            <i class="fas fa-home text-xl"></i>
            <span class="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </button>
        
        <button onclick="showMyCourses()" class="nav-btn flex flex-col items-center gap-1 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-300 trans-all relative">
            <i class="fas fa-book-reader text-xl"></i>
            <span class="text-[10px] font-bold">Ø¯ÙˆØ±Ø§ØªÙŠ</span>
            <span id="myCoursesDot" class="hidden absolute top-0 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
        </button>
        
        <button onclick="openWhatsApp()" class="nav-btn flex flex-col items-center gap-1 text-gray-400 hover:text-green-500 trans-all">
            <i class="fab fa-whatsapp text-xl"></i>
            <span class="text-[10px] font-bold">ØªÙˆØ§ØµÙ„</span>
        </button>
    </nav>

    <!-- WhatsApp Floating Button -->
    <a href="https://wa.me/249908280115" target="_blank" class="hidden md:flex fixed bottom-8 left-8 w-14 h-14 bg-green-500 text-white rounded-full items-center justify-center shadow-lg shadow-green-500/40 hover:scale-110 trans-all z-50 animate-bounce">
        <i class="fab fa-whatsapp text-2xl"></i>
    </a>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="fixed inset-0 z-[100] bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm flex items-center justify-center hidden">
        <div class="relative">
            <div class="w-20 h-20 border-4 border-indigo-200 rounded-full"></div>
            <div class="w-20 h-20 border-4 border-indigo-600 rounded-full absolute top-0 left-0 animate-spin border-t-transparent"></div>
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-indigo-600 font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>
    </div>

<script>
// ===== FIREBASE CONFIGURATION =====
// âš ï¸ Ù…Ù‡Ù…: Ø§Ø³ØªØ¨Ø¯Ù„ SITE_KEY_FROM_RECAPTCHA Ø¨Ù…ÙØªØ§Ø­ Ù…ÙˆÙ‚Ø¹Ùƒ Ù…Ù† reCAPTCHA v3
const FIREBASE_CONFIG = {
    apiKey: "AIzaSyDgFy0-QL0YuGgqgtcx9541Cs7QxBewRKQ",
    authDomain: "skillzoy-5ba3c.firebaseapp.com",
    projectId: "skillzoy-5ba3c",
    storageBucket: "skillzoy-5ba3c.firebasestorage.app",
    messagingSenderId: "622606995088",
    appId: "1:622606995088:web:999c8a6790e7aa30651215",
    measurementId: "G-WVHTQ4BGNJ"
};

const RECAPTCHA_SITE_KEY = 
"6LdzPWcsAAAAAMVoYBW_8Sk2C2PvRViVqlW3LKXh"; // â† Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ÙØ¹Ù„ÙŠ

// ===== APP INITIALIZATION =====
let firebaseApp, db, appCheck;
let appInitialized = false;

async function initializeFirebase() {
    try {
        if (appInitialized) return;
        
        showLoading(true);
        
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebaseApp = firebase.initializeApp(FIREBASE_CONFIG);
        } else {
            firebaseApp = firebase.app();
        }
        
        // Initialize Firestore
        db = firebase.firestore();
        
        // Initialize App Check with reCAPTCHA v3
        appCheck = firebase.appCheck();
        
        // Activate App Check (debug mode for development)
        // Remove true parameter for production
        await appCheck.activate(RECAPTCHA_SITE_KEY, true);
        
        console.log("Firebase and App Check initialized successfully");
        showToast("ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­", "success");
        appInitialized = true;
        
    } catch (error) {
        console.error("Firebase initialization error:", error);
        showToast("Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„", "error");
        // Fallback: Load sample data
        loadSampleData();
    } finally {
        showLoading(false);
    }
}

// ===== STATE MANAGEMENT =====
let appState = {
    courses: [],
    filteredCourses: [],
    myCourses: JSON.parse(localStorage.getItem("skillzoy_myCourses")) || [],
    progress: JSON.parse(localStorage.getItem("skillzoy_progress")) || {},
    darkMode: localStorage.getItem("skillzoy_darkMode") === "true",
    currentCourseId: null,
    categories: [],
    searchQuery: "",
    currentFilter: "all"
};

// ===== APP INITIALIZATION =====
document.addEventListener('DOMContentLoaded', async () => {
    // Set up theme
    setupTheme();
    
    // Set up event listeners
    setupEventListeners();
    
    // Initialize Firebase
    await initializeFirebase();
    
    // Render UI
    renderSkeletons();
    renderCategories();
    
    // Fetch courses from Firestore
    await fetchCourses();
    
    // Update navigation state
    updateNavState();
});

// ===== THEME MANAGEMENT =====
function setupTheme() {
    if (appState.darkMode) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
}

function toggleDarkMode() {
    appState.darkMode = !appState.darkMode;
    localStorage.setItem("skillzoy_darkMode", appState.darkMode);
    document.documentElement.classList.toggle('dark');
    
    showToast(appState.darkMode ? "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† Ù…ÙØ¹Ù„" : "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ Ù…ÙØ¹Ù„", "info");
}

// ===== DATA FETCHING =====
async function fetchCourses() {
    try {
        showLoading(true);
        
        // Get App Check token (for debugging)
        if (appCheck) {
            const token = await appCheck.getToken();
            console.log("App Check Token:", token);
        }
        
        // Fetch courses from Firestore
        const snapshot = await db.collection('courses').get();
        
        if (snapshot.empty) {
            console.log("No courses found in Firestore");
            loadSampleData();
            return;
        }
        
        appState.courses = [];
        snapshot.forEach(doc => {
            const courseData = doc.data();
            appState.courses.push({ 
                id: doc.id, 
                ...courseData,
                // Ensure required fields
                title: courseData.title || "Ø¯ÙˆØ±Ø© Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†",
                category: courseData.category || "Ø¹Ø§Ù…",
                description: courseData.description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù„Ø¯ÙˆØ±Ø©",
                price: courseData.price || "Ù…Ø¬Ø§Ù†ÙŠØ©",
                playlist_id: courseData.playlist_id || null,
                num: courseData.num || 10
            });
        });
        
        console.log(`Loaded ${appState.courses.length} courses from Firestore`);
        
        // Extract unique categories
        appState.categories = [...new Set(appState.courses.map(c => c.category))];
        
        // Render UI
        renderCategories();
        renderCourses();
        renderMyCourses();
        
        showToast(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${appState.courses.length} Ø¯ÙˆØ±Ø©`, "success");
        
    } catch (error) {
        console.error("Error fetching courses:", error);
        showToast("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§ØªØŒ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©", "error");
        loadSampleData();
    } finally {
        showLoading(false);
    }
}

function loadSampleData() {
    // Sample data for fallback
    appState.courses = [
        {
            id: "1",
            title: "Ø¯ÙˆØ±Ø© ØªØ·ÙˆÙŠØ± Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©",
            category: "Ø¨Ø±Ù…Ø¬Ø©",
            description: "ØªØ¹Ù„Ù… ØªØ·ÙˆÙŠØ± Ø§Ù„ÙˆÙŠØ¨ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª",
            price: "Ù…Ø¬Ø§Ù†ÙŠØ©",
            playlist_id: "PLDoPjvoNmBAw_t_XWUFbBX-c9MafPk9ji",
            num: 12
        },
        {
            id: "2",
            title: "ØªØµÙ…ÙŠÙ… UI/UX Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†",
            category: "ØªØµÙ…ÙŠÙ…",
            description: "Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ ÙÙŠ Ø¹Ø§Ù„Ù… ØªØµÙ…ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª",
            price: "Ù…Ø¬Ø§Ù†ÙŠØ©",
            playlist_id: "PLDoPjvoNmBAyvmJ8cbi0Q8Vll7f1aMN5w",
            num: 8
        }
    ];
    
    appState.categories = [...new Set(appState.courses.map(c => c.category))];
    
    renderCategories();
    renderCourses();
    showToast("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©", "info");
}

// ===== RENDERING FUNCTIONS =====
function renderSkeletons() {
    const grid = document.getElementById('coursesGrid');
    grid.innerHTML = Array(6).fill(0).map(() => `
        <div class="glass-card rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-gray-700 animate-pulse">
            <div class="skeleton w-full h-40 rounded-xl mb-4"></div>
            <div class="skeleton w-3/4 h-6 rounded-lg mb-2"></div>
            <div class="skeleton w-1/2 h-4 rounded-lg mb-4"></div>
            <div class="flex justify-between">
                <div class="skeleton w-20 h-8 rounded-lg"></div>
                <div class="skeleton w-20 h-8 rounded-lg"></div>
            </div>
        </div>
    `).join('');
}

function renderCategories() {
    const container = document.getElementById('categoriesContainer');
    const filterSelect = document.getElementById('categoryFilter');
    
    // Clear existing
    container.innerHTML = '';
    filterSelect.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</option>';
    
    // Add "All" category button
    container.innerHTML = `
        <div onclick="filterByCategory('all')" class="min-w-[110px] h-28 cursor-pointer rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 text-white flex flex-col items-center justify-center gap-2 shadow-lg shadow-indigo-500/30 trans-all hover:scale-105">
            <i class="fas fa-th-large text-xl"></i>
            <span class="text-sm font-bold">Ø§Ù„ÙƒÙ„</span>
        </div>
    `;
    
    // Add category buttons
    appState.categories.forEach(cat => {
        // Category button
        container.innerHTML += `
            <div onclick="filterByCategory('${cat}')" class="min-w-[110px] h-28 cursor-pointer rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 flex flex-col items-center justify-center gap-2 hover:border-indigo-500 hover:shadow-lg trans-all group">
                <div class="w-10 h-10 rounded-full bg-indigo-50 dark:bg-gray-700 text-indigo-600 dark:text-indigo-400 flex items-center justify-center text-lg group-hover:scale-110 trans-all">
                    ${getCategoryIcon(cat)}
                </div>
                <span class="text-sm font-bold text-gray-700 dark:text-gray-300 line-clamp-1">${cat}</span>
            </div>
        `;
        
        // Filter dropdown option
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        filterSelect.appendChild(option);
    });
}

function getCategoryIcon(cat) {
    const iconMap = {
        'Ø¨Ø±Ù…Ø¬Ø©': '<i class="fas fa-code"></i>',
        'ØªØµÙ…ÙŠÙ…': '<i class="fas fa-paint-brush"></i>',
        'ØªØ³ÙˆÙŠÙ‚': '<i class="fas fa-bullhorn"></i>',
        'Ù„ØºØ§Øª': '<i class="fas fa-language"></i>',
        'Ø·Ø¨ ÙˆØµØ­Ø©': '<i class="fas fa-heartbeat"></i>',
        'Ø£Ø¹Ù…Ø§Ù„': '<i class="fas fa-briefcase"></i>',
        'ØªØ·ÙˆÙŠØ± Ø§Ù„Ø°Ø§Øª': '<i class="fas fa-lightbulb"></i>',
        'Ù…Ù‡Ø§Ø±Ø§Øª ØªÙ‚Ù†ÙŠØ©': '<i class="fas fa-laptop-code"></i>',
        'Ø¥Ø¯Ø§Ø±Ø©': '<i class="fas fa-chart-line"></i>',
        'Ù…Ø­Ø§Ø³Ø¨Ø©': '<i class="fas fa-calculator"></i>',
        'ØªØµÙˆÙŠØ±': '<i class="fas fa-camera"></i>',
        'Ø·Ø¨Ø®': '<i class="fas fa-utensils"></i>',
        'Ù„ÙŠØ§Ù‚Ø© Ø¨Ø¯Ù†ÙŠØ©': '<i class="fas fa-dumbbell"></i>',
        'ÙÙ†ÙˆÙ†': '<i class="fas fa-palette"></i>',
        'Ù…ÙˆØ³ÙŠÙ‚Ù‰': '<i class="fas fa-music"></i>',
        'ØªØ¹Ù„ÙŠÙ…': '<i class="fas fa-chalkboard-teacher"></i>'
    };
    return iconMap[cat] || '<i class="fas fa-book"></i>';
}

function renderCourses(filterCategory = "all", searchQuery = "") {
    const grid = document.getElementById('coursesGrid');
    const noResults = document.getElementById('noResults');
    
    let filtered = [...appState.courses];
    
    // Apply category filter
    if (filterCategory && filterCategory !== "all") {
        filtered = filtered.filter(course => course.category === filterCategory);
    }
    
    // Apply search filter
    if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filtered = filtered.filter(course => 
            course.title.toLowerCase().includes(query) ||
            course.description.toLowerCase().includes(query) ||
            course.category.toLowerCase().includes(query)
        );
    }
    
    appState.filteredCourses = filtered;
    
    // Show/hide no results message
    if (filtered.length === 0) {
        grid.innerHTML = '';
        noResults.classList.remove('hidden');
        return;
    }
    
    noResults.classList.add('hidden');
    
    // Render courses
    grid.innerHTML = filtered.map(course => {
        const isEnrolled = appState.myCourses.includes(course.id);
        const priceDisplay = (course.price === 'free' || course.price === 'Ù…Ø¬Ø§Ù†ÙŠØ©' || !course.price) 
            ? '<span class="text-green-500 font-bold">Ù…Ø¬Ø§Ù†ÙŠØ©</span>' 
            : `<span class="text-indigo-600 dark:text-indigo-400 font-bold">${course.price}</span>`;
        
        // Video embed
        let videoEmbed = '';
        if (course.playlist_id) {
            videoEmbed = `<iframe class="absolute inset-0 w-full h-full" 
                                  src="https://www.youtube.com/embed/videoseries?list=${course.playlist_id}&rel=0&modestbranding=1" 
                                  frameborder="0" 
                                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                  allowfullscreen
                                  loading="lazy">
                          </iframe>`;
        } else {
            videoEmbed = `<div class="absolute inset-0 w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-800 flex items-center justify-center text-gray-500">
                            <i class="fas fa-video-slash text-4xl"></i>
                          </div>`;
        }
        
        return `
        <div class="glass-card rounded-2xl overflow-hidden hover:transform hover:-translate-y-2 trans-all duration-300 group h-full flex flex-col">
            <div class="relative w-full aspect-video bg-black rounded-t-2xl overflow-hidden">
                ${videoEmbed}
                
                <div class="absolute top-2 left-2 z-20 bg-black/60 backdrop-blur-md text-white text-xs px-2 py-1 rounded-lg border border-white/20">
                    ${course.category || 'Ø¹Ø§Ù…'}
                </div>
                
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 trans-all"></div>
            </div>

            <div class="p-5 flex flex-col flex-1">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2 line-clamp-2">${course.title}</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4 line-clamp-2 flex-1">${course.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                
                <div class="flex items-center justify-between mt-auto pt-4 border-t border-gray-100 dark:border-gray-700">
                    ${priceDisplay}
                    <button onclick="${isEnrolled ? `openPlayer('${course.id}')` : `enrollCourse('${course.id}')`}" 
                        class="${isEnrolled ? 'bg-green-100 hover:bg-green-200 text-green-600 dark:bg-green-900/30 dark:hover:bg-green-900/50 dark:text-green-400' : 'bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-500/30'} 
                        px-4 py-2 rounded-xl text-sm font-bold trans-all duration-200">
                        ${isEnrolled ? '<i class="fas fa-play text-xs ml-1"></i> Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¯ÙˆØ±Ø©' : '<i class="fas fa-plus text-xs ml-1"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¢Ù†'}
                    </button>
                </div>
            </div>
        </div>
        `;
    }).join('');
}

// ===== COURSE MANAGEMENT =====
function enrollCourse(courseId) {
    try {
        if (!appState.myCourses.includes(courseId)) {
            appState.myCourses.push(courseId);
            localStorage.setItem("skillzoy_myCourses", JSON.stringify(appState.myCourses));
            
            // Initialize progress
            if (!appState.progress[courseId]) {
                const course = appState.courses.find(c => c.id === courseId);
                appState.progress[courseId] = {
                    completed: [],
                    total: course?.num || 10,
                    lastAccessed: new Date().toISOString()
                };
                localStorage.setItem("skillzoy_progress", JSON.stringify(appState.progress));
            }
            
            showToast("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¯ÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰", "success");
            renderCourses();
            renderMyCourses();
            updateNavState();
        }
    } catch (error) {
        console.error("Error enrolling course:", error);
        showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„", "error");
    }
}

function removeCourse(courseId, event) {
    if (event) event.stopPropagation();
    
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ±Ø© Ù…Ù† Ù‚Ø§Ø¦Ù…ØªÙƒØŸ")) {
        appState.myCourses = appState.myCourses.filter(id => id !== courseId);
        localStorage.setItem("skillzoy_myCourses", JSON.stringify(appState.myCourses));
        
        // Remove progress data
        if (appState.progress[courseId]) {
            delete appState.progress[courseId];
            localStorage.setItem("skillzoy_progress", JSON.stringify(appState.progress));
        }
        
        showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ±Ø©", "info");
        renderMyCourses();
        renderCourses();
        updateNavState();
    }
}

// ===== VIDEO PLAYER =====
function openPlayer(courseId) {
    const course = appState.courses.find(c => c.id === courseId);
    if (!course) return;
    
    appState.currentCourseId = courseId;
    
    // Update player UI
    document.getElementById('playerCourseTitle').textContent = course.title;
    document.getElementById('playerCourseDesc').textContent = course.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ';
    
    // Load YouTube playlist
    const frame = document.getElementById('playerFrame');
    if (course.playlist_id) {
        frame.src = `https://www.youtube.com/embed/videoseries?list=${course.playlist_id}&rel=0&modestbranding=1&autoplay=1`;
    } else {
        frame.src = "";
        frame.innerHTML = '<div class="absolute inset-0 flex items-center justify-center text-white">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ Ù…ØªØ§Ø­</div>';
    }
    
    // Render playlist
    renderPlaylistItems(courseId, course.num || 10);
    
    // Save last viewed course
    localStorage.setItem("skillzoy_lastViewed", JSON.stringify({
        id: courseId,
        title: course.title,
        timestamp: new Date().toISOString()
    }));
    
    // Show player
    document.getElementById('playerOverlay').classList.remove('translate-y-full');
    document.body.style.overflow = 'hidden';
}

function closePlayer() {
    document.getElementById('playerOverlay').classList.add('translate-y-full');
    document.getElementById('playerFrame').src = "";
    document.body.style.overflow = 'auto';
    renderMyCourses();
}

function renderPlaylistItems(courseId, totalVideos) {
    const container = document.getElementById('playlistContainer');
    const progressData = appState.progress[courseId] || { completed: [] };
    let html = '';
    
    for (let i = 1; i <= totalVideos; i++) {
        const isCompleted = progressData.completed.includes(i);
        const isCurrent = i === (progressData.completed.length + 1);
        
        html += `
            <div class="flex items-center justify-between p-3 rounded-xl ${isCurrent ? 'bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800' : isCompleted ? 'bg-green-50 dark:bg-green-900/20' : 'bg-white dark:bg-gray-800'} border border-gray-100 dark:border-gray-700 trans-all hover:scale-[1.02]">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold ${isCompleted ? 'bg-green-500 text-white' : isCurrent ? 'bg-indigo-500 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300'}">
                        ${isCompleted ? '<i class="fas fa-check"></i>' : i}
                    </div>
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-200">Ø§Ù„Ø¯Ø±Ø³ ${i}</span>
                </div>
                <button onclick="toggleLessonComplete(${i})" class="text-gray-400 hover:text-green-500 trans-all">
                    <i class="${isCompleted ? 'fas fa-check-circle text-green-500' : 'far fa-circle'}"></i>
                </button>
            </div>
        `;
    }
    
    container.innerHTML = html;
    updateProgressUI(courseId, totalVideos);
}

function toggleLessonComplete(lessonIndex) {
    const courseId = appState.currentCourseId;
    if (!courseId) return;
    
    if (!appState.progress[courseId]) {
        appState.progress[courseId] = { completed: [] };
    }
    
    const completedList = appState.progress[courseId].completed;
    const course = appState.courses.find(c => c.id === courseId);
    const total = course?.num || 10;
    
    // Toggle completion
    if (completedList.includes(lessonIndex)) {
        appState.progress[courseId].completed = completedList.filter(i => i !== lessonIndex);
        showToast(`ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¯Ø±Ø³ ${lessonIndex}`, "info");
    } else {
        appState.progress[courseId].completed.push(lessonIndex);
        showToast(`ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¯Ø±Ø³ ${lessonIndex} Ø¨Ù†Ø¬Ø§Ø­!`, "success");
        
        // Sort completed list
        appState.progress[courseId].completed.sort((a, b) => a - b);
    }
    
    // Save progress
    localStorage.setItem("skillzoy_progress", JSON.stringify(appState.progress));
    
    // Update UI
    renderPlaylistItems(courseId, total);
    renderMyCourses();
}

function toggleCompleteVideo() {
    const courseId = appState.currentCourseId;
    if (!courseId) return;
    
    const course = appState.courses.find(c => c.id === courseId);
    const total = course?.num || 10;
    
    if (!appState.progress[courseId]) {
        appState.progress[courseId] = { completed: [] };
    }
    
    const completedList = appState.progress[courseId].completed;
    
    // Find next incomplete lesson
    let nextLesson = 1;
    while (completedList.includes(nextLesson)) {
        nextLesson++;
    }
    
    if (nextLesson <= total) {
        toggleLessonComplete(nextLesson);
    } else {
        showToast('Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø£ØªÙ…Ù…Øª Ø¬Ù…ÙŠØ¹ Ø¯Ø±ÙˆØ³ Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ±Ø© ğŸ“', 'success');
    }
}

function updateProgressUI(courseId, total) {
    const completed = appState.progress[courseId]?.completed.length || 0;
    const percent = Math.round((completed / total) * 100);
    
    document.getElementById('progressBarFill').style.width = `${percent}%`;
    document.getElementById('progressPercentage').textContent = `${percent}% Ù…ÙƒØªÙ…Ù„`;
    
    // Update button text
    const btn = document.getElementById('markCompleteBtn');
    if (percent === 100) {
        btn.innerHTML = '<i class="fas fa-trophy"></i><span>Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±ÙˆØ³!</span>';
        btn.classList.remove('bg-green-500', 'hover:bg-green-600');
        btn.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
    }
}

// ===== MY COURSES PAGE =====
function renderMyCourses() {
    const grid = document.getElementById('myCoursesGrid');
    const banner = document.getElementById('resumeLearningBanner');
    
    // Check for last viewed course
    const lastViewed = JSON.parse(localStorage.getItem("skillzoy_lastViewed"));
    const shouldShowBanner = lastViewed && appState.myCourses.includes(lastViewed.id);
    
    if (shouldShowBanner) {
        banner.classList.remove('hidden');
        document.getElementById('resumeTitle').textContent = lastViewed.title;
        document.getElementById('resumeBtn').onclick = () => openPlayer(lastViewed.id);
        
        // Calculate progress for resume text
        const courseId = lastViewed.id;
        const course = appState.courses.find(c => c.id === courseId);
        const total = course?.num || 10;
        const completed = appState.progress[courseId]?.completed.length || 0;
        const nextLesson = completed + 1;
        
        document.getElementById('resumeProgress').textContent = 
            nextLesson <= total ? `ØªØ§Ø¨Ø¹ Ù…Ù† Ø§Ù„Ø¯Ø±Ø³ ${nextLesson}` : "Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±ÙˆØ³";
    } else {
        banner.classList.add('hidden');
    }
    
    // Render my courses grid
    if (appState.myCourses.length === 0) {
        grid.innerHTML = `
            <div class="col-span-3 text-center py-20">
                <div class="w-24 h-24 mx-auto bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-book-open text-3xl text-gray-400"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-700 dark:text-gray-300 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª Ù…Ø³Ø¬Ù„Ø©</h3>
                <p class="text-gray-500 dark:text-gray-400 mb-4">Ø³Ø¬Ù„ ÙÙŠ Ø¯ÙˆØ±Ø§ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                <button onclick="showHome()" class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-indigo-700 trans-all">
                    <i class="fas fa-arrow-left ml-2"></i> Ø§Ø³ØªØ¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª
                </button>
            </div>
        `;
        return;
    }
    
    grid.innerHTML = appState.myCourses.map(courseId => {
        const course = appState.courses.find(c => c.id === courseId);
        if (!course) return '';
        
        const total = course.num || 10;
        const completed = appState.progress[courseId]?.completed.length || 0;
        const percent = Math.round((completed / total) * 100);
        const progressColor = percent === 100 ? 'from-green-500 to-emerald-600' : 
                            percent >= 50 ? 'from-blue-500 to-indigo-600' : 
                            'from-yellow-500 to-orange-600';
        
        return `
            <div class="glass-card rounded-2xl p-4 flex gap-4 items-center cursor-pointer hover:bg-white/50 dark:hover:bg-gray-700/50 trans-all group" onclick="openPlayer('${courseId}')">
                <div class="w-16 h-16 rounded-xl bg-gradient-to-br ${progressColor} flex items-center justify-center text-white text-xl shrink-0 shadow-lg">
                    <i class="fas fa-play"></i>
                </div>
                <div class="flex-1 min-w-0">
                    <h4 class="font-bold text-gray-800 dark:text-white truncate group-hover:text-indigo-600 dark:group-hover:text-indigo-400">${course.title}</h4>
                    <div class="flex justify-between items-center text-xs text-gray-500 dark:text-gray-400 mt-1 mb-2">
                        <span><i class="fas fa-book-open ml-1"></i> ${completed}/${total} Ø¯Ø±Ø³</span>
                        <span class="font-bold">${percent}%</span>
                    </div>
                    <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r ${progressColor} rounded-full" style="width: ${percent}%"></div>
                    </div>
                </div>
                <button onclick="removeCourse('${courseId}', event)" class="text-gray-300 hover:text-red-500 px-2 trans-all opacity-0 group-hover:opacity-100">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        `;
    }).join('');
}

// ===== NAVIGATION =====
function showHome() {
    document.getElementById('heroSection').classList.remove('hidden');
    document.getElementById('coursesSection').classList.remove('hidden');
    document.getElementById('myCoursesView').classList.add('hidden');
    setActiveNav(0);
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showMyCourses() {
    document.getElementById('heroSection').classList.add('hidden');
    document.getElementById('coursesSection').classList.add('hidden');
    document.getElementById('myCoursesView').classList.remove('hidden');
    renderMyCourses();
    setActiveNav(1);
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function setActiveNav(index) {
    const btns = document.querySelectorAll('.nav-btn');
    btns.forEach((btn, i) => {
        if (i === index) {
            btn.classList.add('text-indigo-600', 'dark:text-indigo-400', 'active');
            btn.classList.remove('text-gray-400');
        } else {
            btn.classList.remove('text-indigo-600', 'dark:text-indigo-400', 'active');
            btn.classList.add('text-gray-400');
        }
    });
}

function updateNavState() {
    const dot = document.getElementById('myCoursesDot');
    if (appState.myCourses.length > 0) {
        dot.classList.remove('hidden');
    } else {
        dot.classList.add('hidden');
    }
}

// ===== FILTERING =====
function filterByCategory(category) {
    appState.currentFilter = category;
    document.getElementById('categoryFilter').value = category;
    renderCourses(category, appState.searchQuery);
}

function setupEventListeners() {
    // Search input
    document.getElementById('searchInput').addEventListener('input', (e) => {
        appState.searchQuery = e.target.value;
        renderCourses(appState.currentFilter, appState.searchQuery);
    });
    
    // Category filter
    document.getElementById('categoryFilter').addEventListener('change', (e) => {
        filterByCategory(e.target.value);
    });
    
    // WhatsApp
    window.openWhatsApp = function() {
        window.open("https://wa.me/249908280115", "_blank", "noopener,noreferrer");
    };
}

// ===== UTILITY FUNCTIONS =====
function showLoading(show) {
    const spinner = document.getElementById('loadingSpinner');
    if (show) {
        spinner.classList.remove('hidden');
    } else {
        spinner.classList.add('hidden');
    }
}

function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        info: 'bg-indigo-500',
        warning: 'bg-yellow-500'
    };
    
    toast.className = `fixed top-6 left-1/2 transform -translate-x-1/2 ${colors[type] || 'bg-gray-800'} text-white px-6 py-3 rounded-full shadow-2xl z-[70] flex items-center gap-3 animate-float font-bold text-sm min-w-[300px] justify-center`;
    toast.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
        <span>${message}</span>
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// ===== SECURITY MEASURES =====
(() => {
    // Prevent right-click
    document.addEventListener('contextmenu', e => e.preventDefault());
    
    // Prevent text selection
    document.addEventListener('selectstart', e => e.preventDefault());
    
    // Prevent keyboard shortcuts for dev tools
    document.addEventListener('keydown', (e) => {
        // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+Shift+C, Ctrl+U
        if (
            e.key === 'F12' ||
            (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(e.key.toUpperCase())) ||
            (e.ctrlKey && e.key.toUpperCase() === 'U')
        ) {
            e.preventDefault();
            showToast('Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡', 'error');
        }
    });
    
    // Prevent copy/paste
    document.addEventListener('copy', e => e.preventDefault());
    document.addEventListener('cut', e => e.preventDefault());
    document.addEventListener('paste', e => e.preventDefault());
})();

// ===== WINDOW EVENTS =====
window.addEventListener('beforeunload', () => {
    // Save state before leaving
    localStorage.setItem("skillzoy_myCourses", JSON.stringify(appState.myCourses));
    localStorage.setItem("skillzoy_progress", JSON.stringify(appState.progress));
});

// Initialize app when window loads
window.onload = () => {
    console.log("Skillzoy Academy - App Initialized");
    showToast("Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø³ÙƒÙŠÙ„Ø²ÙˆÙŠ! ğŸ‘‹", "info");
};
</script>
</body>
</html>
